{
  'targets': [
    {
      'target_name': 'xwalk_all_tests',
      'type': 'none',
      'dependencies': [
        'xwalk_browsertest',
        'xwalk_unittest',
        'extensions/extensions_tests.gyp:xwalk_extensions_browsertest',
        'extensions/extensions_tests.gyp:xwalk_extensions_unittest',
        'sysapps/sysapps_tests.gyp:xwalk_sysapps_browsertest',
        'sysapps/sysapps_tests.gyp:xwalk_sysapps_unittest',
      ],
      'conditions': [
        ['OS=="linux"', {
          'dependencies': [
            'dbus/xwalk_dbus.gyp:xwalk_dbus_unittests',
          ],
        }],
      ],
    },
    {
      'target_name': 'xwalk_unittest',
      'type': 'executable',
      'dependencies': [
        '../base/base.gyp:base',
        '../content/content.gyp:content_common',
        '../content/content_shell_and_tests.gyp:test_support_content',
        '../testing/gtest.gyp:gtest',
        '../ui/ui.gyp:ui',
        'test/base/base.gyp:xwalk_test_base',
        'xwalk_application_lib',
        'xwalk_runtime',
      ],
      'sources': [
        'application/browser/application_event_router_unittest.cc',
        'application/browser/application_storage_impl_unittest.cc',
        'application/browser/installer/package_unittest.cc',
        'application/common/application_unittest.cc',
        'application/common/application_file_util_unittest.cc',
        'application/common/id_util_unittest.cc',
        'application/common/manifest_handlers/csp_handler_unittest.cc',
        'application/common/manifest_handlers/main_document_handler_unittest.cc',
        'application/common/manifest_handlers/permissions_handler_unittest.cc',
        'application/common/manifest_handler_unittest.cc',
        'application/common/manifest_unittest.cc',
        'runtime/common/xwalk_content_client_unittest.cc',
        'runtime/common/xwalk_runtime_features_unittest.cc',
      ],
      'conditions': [
        ['toolkit_views == 1', {
          'sources': [
            'runtime/browser/ui/top_view_layout_views_unittest.cc',
          ],
          'dependencies': [
            '../skia/skia.gyp:skia',
          ],
        }],
      ],
    },
    {
      'target_name': 'automation_client_lib',
      'type': 'static_library',
      'hard_dependency': 1,
      'dependencies': [
        '../base/base.gyp:base',
        '../base/third_party/dynamic_annotations/dynamic_annotations.gyp:dynamic_annotations',
        '../net/net.gyp:net',
        '../third_party/zlib/zlib.gyp:minizip',
        '../third_party/zlib/zlib.gyp:zlib',
        '../ui/events/events.gyp:events',
        '../ui/gfx/gfx.gyp:gfx',
        '../ui/ui.gyp:ui',
        '../url/url.gyp:url_lib',
      ],
      'include_dirs': [
        '..',
        '<(SHARED_INTERMEDIATE_DIR)',
      ],
      'direct_dependent_settings': {
        'include_dirs': [
          '<(SHARED_INTERMEDIATE_DIR)',
        ],
      },
      'sources': [
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/js.cc',
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/js.h',
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/user_data_dir.cc',
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/user_data_dir.h',
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/embedded_automation_extension.cc',
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/embedded_automation_extension.h',
        'test/chromedriver/chrome/adb.h',
        'test/chromedriver/chrome/adb_impl.cc',
        'test/chromedriver/chrome/adb_impl.h',
        'test/chromedriver/chrome/automation_extension.cc',
        'test/chromedriver/chrome/automation_extension.h',
        'test/chromedriver/chrome/chrome.h',
        'test/chromedriver/chrome/xwalk_android_impl.cc',
        'test/chromedriver/chrome/xwalk_android_impl.h',
        'test/chromedriver/chrome/xwalk_desktop_impl.cc',
        'test/chromedriver/chrome/xwalk_desktop_impl.h',
        'test/chromedriver/chrome/xwalk_existing_impl.cc',
        'test/chromedriver/chrome/xwalk_existing_impl.h',
        'test/chromedriver/chrome/xwalk_finder.cc',
        'test/chromedriver/chrome/xwalk_finder.h',
        'test/chromedriver/chrome/chrome_finder_mac.mm',
        'test/chromedriver/chrome/chrome_impl.cc',
        'test/chromedriver/chrome/chrome_impl.h',
        'test/chromedriver/chrome/console_logger.cc',
        'test/chromedriver/chrome/console_logger.h',
        'test/chromedriver/chrome/debugger_tracker.cc',
        'test/chromedriver/chrome/debugger_tracker.h',
        'test/chromedriver/chrome/device_manager.cc',
        'test/chromedriver/chrome/device_manager.h',
        'test/chromedriver/chrome/devtools_client.h',
        'test/chromedriver/chrome/devtools_client_impl.cc',
        'test/chromedriver/chrome/devtools_client_impl.h',
        'test/chromedriver/chrome/devtools_event_listener.cc',
        'test/chromedriver/chrome/devtools_event_listener.h',
        'test/chromedriver/chrome/devtools_http_client.cc',
        'test/chromedriver/chrome/devtools_http_client.h',
        'test/chromedriver/chrome/dom_tracker.cc',
        'test/chromedriver/chrome/dom_tracker.h',
        'test/chromedriver/chrome/frame_tracker.cc',
        'test/chromedriver/chrome/frame_tracker.h',
        'test/chromedriver/chrome/geolocation_override_manager.cc',
        'test/chromedriver/chrome/geolocation_override_manager.h',
        'test/chromedriver/chrome/geoposition.h',
        'test/chromedriver/chrome/heap_snapshot_taker.cc',
        'test/chromedriver/chrome/heap_snapshot_taker.h',
        'test/chromedriver/chrome/javascript_dialog_manager.cc',
        'test/chromedriver/chrome/javascript_dialog_manager.h',
        'test/chromedriver/chrome/log.h',
        'test/chromedriver/chrome/log.cc',
        'test/chromedriver/chrome/navigation_tracker.cc',
        'test/chromedriver/chrome/navigation_tracker.h',
        'test/chromedriver/chrome/performance_logger.h',
        'test/chromedriver/chrome/performance_logger.cc',
        'test/chromedriver/chrome/status.cc',
        'test/chromedriver/chrome/status.h',
        'test/chromedriver/chrome/ui_events.cc',
        'test/chromedriver/chrome/ui_events.h',
        'test/chromedriver/chrome/util.cc',
        'test/chromedriver/chrome/util.h',
        'test/chromedriver/chrome/version.cc',
        'test/chromedriver/chrome/version.h',
        'test/chromedriver/chrome/web_view.h',
        'test/chromedriver/chrome/web_view_impl.cc',
        'test/chromedriver/chrome/web_view_impl.h',
        'test/chromedriver/chrome/chrome.h',
        'test/chromedriver/chrome/xwalk_android_impl.cc',
        'test/chromedriver/chrome/xwalk_android_impl.h',
        'test/chromedriver/chrome/xwalk_desktop_impl.cc',
        'test/chromedriver/chrome/xwalk_desktop_impl.h',
        'test/chromedriver/chrome/xwalk_existing_impl.cc',
        'test/chromedriver/chrome/xwalk_existing_impl.h',
        'test/chromedriver/chrome/xwalk_finder.cc',
        'test/chromedriver/chrome/xwalk_finder.h',
        'test/chromedriver/chrome/chrome_finder_mac.mm',
        'test/chromedriver/chrome/chrome_impl.cc',
        'test/chromedriver/chrome/chrome_impl.h',
        'test/chromedriver/chrome/zip.cc',
        'test/chromedriver/chrome/zip.h',
        'test/chromedriver/chrome/zip_internal.cc',
        'test/chromedriver/chrome/zip_internal.h',
        'test/chromedriver/chrome/zip_reader.cc',
        'test/chromedriver/chrome/zip_reader.h',
        'test/chromedriver/net/adb_client_socket.cc',
        'test/chromedriver/net/adb_client_socket.h',
        'test/chromedriver/net/net_util.cc',
        'test/chromedriver/net/net_util.h',
        'test/chromedriver/net/port_server.cc',
        'test/chromedriver/net/port_server.h',
        'test/chromedriver/net/sync_websocket.h',
        'test/chromedriver/net/sync_websocket_factory.cc',
        'test/chromedriver/net/sync_websocket_factory.h',
        'test/chromedriver/net/sync_websocket_impl.cc',
        'test/chromedriver/net/sync_websocket_impl.h',
        'test/chromedriver/net/url_request_context_getter.cc',
        'test/chromedriver/net/url_request_context_getter.h',
        'test/chromedriver/net/websocket.cc',
        'test/chromedriver/net/websocket.h',
      ],
      'actions': [
        {
          'action_name': 'embed_js_in_cpp',
          'inputs': [
            'test/chromedriver/cpp_source.py',
            'test/chromedriver/embed_js_in_cpp.py',
            'test/chromedriver/js/add_cookie.js',
            'test/chromedriver/js/call_function.js',
            'test/chromedriver/js/dispatch_context_menu_event.js',
            'test/chromedriver/js/execute_async_script.js',
            'test/chromedriver/js/focus.js',
            'test/chromedriver/js/get_element_region.js',
            'test/chromedriver/js/is_option_element_toggleable.js',
          ],
          'outputs': [
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/js.cc',
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/js.h',
          ],
          'action': [ 'python',
                      'test/chromedriver/embed_js_in_cpp.py',
                      '--directory',
                      '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome',
                      'test/chromedriver/js/add_cookie.js',
                      'test/chromedriver/js/call_function.js',
                      'test/chromedriver/js/dispatch_context_menu_event.js',
                      'test/chromedriver/js/execute_async_script.js',
                      'test/chromedriver/js/focus.js',
                      'test/chromedriver/js/get_element_region.js',
                      'test/chromedriver/js/is_option_element_toggleable.js',
          ],
          'message': 'Generating sources for embedding js in chromedriver',
        },
        {
          'action_name': 'embed_user_data_dir_in_cpp',
          'inputs': [
            'test/chromedriver/cpp_source.py',
            'test/chromedriver/embed_user_data_dir_in_cpp.py',
            'test/chromedriver/chrome/preferences.txt',
            'test/chromedriver/chrome/local_state.txt',
          ],
          'outputs': [
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/user_data_dir.cc',
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/user_data_dir.h',
          ],
          'action': [ 'python',
                      'test/chromedriver/embed_user_data_dir_in_cpp.py',
                      '--directory',
                      '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome',
                      'test/chromedriver/chrome/preferences.txt',
                      'test/chromedriver/chrome/local_state.txt',
          ],
          'message': 'Generating sources for embedding user data dir in chromedriver',
        },
        {
          'action_name': 'embed_extension_in_cpp',
          'inputs': [
            'test/chromedriver/cpp_source.py',
            'test/chromedriver/embed_extension_in_cpp.py',
            'test/chromedriver/extension/background.js',
            'test/chromedriver/extension/manifest.json',
          ],
          'outputs': [
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/embedded_automation_extension.cc',
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome/embedded_automation_extension.h',
          ],
          'action': [ 'python',
                      'test/chromedriver/embed_extension_in_cpp.py',
                      '--directory',
                      '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/chrome',
                      'test/chromedriver/extension/background.js',
                      'test/chromedriver/extension/manifest.json',
          ],
          'message': 'Generating sources for embedding automation extension',
        },
      ],
      # TODO(jschuh): crbug.com/167187 fix size_t to int truncations.
      'msvs_disabled_warnings': [ 4267, ],
    },
    {
      'target_name': 'xwalkdriver_lib',
      'type': 'static_library',
      'hard_dependency': 1,
      'dependencies': [
        'automation_client_lib',
        '../base/base.gyp:base',
        '../base/third_party/dynamic_annotations/dynamic_annotations.gyp:dynamic_annotations',
        '../crypto/crypto.gyp:crypto',
        '../net/net.gyp:http_server',
        '../net/net.gyp:net',
        '../ui/events/events.gyp:events',
        '../ui/gfx/gfx.gyp:gfx',
        '../ui/ui.gyp:ui',
      ],
      'include_dirs': [
        '..',
      ],
      'sources': [
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/version.cc',
        '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/version.h',
        '../third_party/webdriver/atoms.cc',
        '../third_party/webdriver/atoms.h',
        'test/chromedriver/alert_commands.cc',
        'test/chromedriver/alert_commands.h',
        'test/chromedriver/basic_types.cc',
        'test/chromedriver/basic_types.h',
        'test/chromedriver/capabilities.cc',
        'test/chromedriver/capabilities.h',
        'test/chromedriver/command.h',
        'test/chromedriver/commands.cc',
        'test/chromedriver/commands.h',
        'test/chromedriver/element_commands.cc',
        'test/chromedriver/element_commands.h',
        'test/chromedriver/element_util.cc',
        'test/chromedriver/element_util.h',
        'test/chromedriver/key_converter.cc',
        'test/chromedriver/key_converter.h',
        'test/chromedriver/keycode_text_conversion.h',
        'test/chromedriver/keycode_text_conversion_x.cc',
        'test/chromedriver/logging.cc',
        'test/chromedriver/logging.h',
        'test/chromedriver/server/http_handler.cc',
        'test/chromedriver/server/http_handler.h',
        'test/chromedriver/session.cc',
        'test/chromedriver/session.h',
        'test/chromedriver/session_commands.cc',
        'test/chromedriver/session_commands.h',
        'test/chromedriver/session_thread_map.h',
        'test/chromedriver/util.cc',
        'test/chromedriver/util.h',
        'test/chromedriver/window_commands.cc',
        'test/chromedriver/window_commands.h',
        'test/chromedriver/xwalk_launcher.cc',
        'test/chromedriver/xwalk_launcher.h',
      ],
      'actions': [
        {
          'action_name': 'embed_version_in_cpp',
          'inputs': [
            'test/chromedriver/cpp_source.py',
            'test/chromedriver/embed_version_in_cpp.py',
            'test/chromedriver/VERSION',
          ],
          'outputs': [
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/version.cc',
            '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/version.h',
          ],
          'action': [ 'python',
                      'test/chromedriver/embed_version_in_cpp.py',
                      '--version-file',
                      'test/chromedriver/VERSION',
                      '--directory',
                      '<(SHARED_INTERMEDIATE_DIR)/xwalk/test/chromedriver/',
          ],
          'message': 'Generating version info',
        },
      ],
      'direct_dependent_settings': {
        'include_dirs': [
          '<(SHARED_INTERMEDIATE_DIR)',
        ],
      },
    },
    {
      'target_name': 'xwalkdriver',
      'type': 'executable',
      'dependencies': [
        'xwalkdriver_lib',
      ],
      'include_dirs': [
        '..',
      ],
      'sources': [
        'test/chromedriver/server/chromedriver_server.cc',
      ],
    },
    {
      'target_name': 'chromedriver_unittests',
      'type': 'executable',
      'dependencies': [
        'xwalkdriver_lib',
        '../base/base.gyp:base',
        '../base/base.gyp:run_all_unittests',
        '../net/net.gyp:http_server',
        '../net/net.gyp:net',
        '../testing/gtest.gyp:gtest',
        '../ui/events/events.gyp:events',
        '../ui/gfx/gfx.gyp:gfx',
        '../ui/ui.gyp:ui',
      ],
      'include_dirs': [
        '..,'
      ],
      'sources': [
        'test/chromedriver/capabilities_unittest.cc',
        'test/chromedriver/chrome/console_logger_unittest.cc',
        'test/chromedriver/chrome/devtools_client_impl_unittest.cc',
        'test/chromedriver/chrome/devtools_http_client_unittest.cc',
        'test/chromedriver/chrome/dom_tracker_unittest.cc',
        'test/chromedriver/chrome/frame_tracker_unittest.cc',
        'test/chromedriver/chrome/geolocation_override_manager_unittest.cc',
        'test/chromedriver/chrome/heap_snapshot_taker_unittest.cc',
        'test/chromedriver/chrome/javascript_dialog_manager_unittest.cc',
        'test/chromedriver/chrome/navigation_tracker_unittest.cc',
        'test/chromedriver/chrome/performance_logger_unittest.cc',
        'test/chromedriver/chrome/status_unittest.cc',
        'test/chromedriver/chrome/stub_chrome.cc',
        'test/chromedriver/chrome/stub_chrome.h',
        'test/chromedriver/chrome/stub_devtools_client.cc',
        'test/chromedriver/chrome/stub_devtools_client.h',
        'test/chromedriver/chrome/stub_web_view.cc',
        'test/chromedriver/chrome/stub_web_view.h',
        'test/chromedriver/chrome/web_view_impl_unittest.cc',
        'test/chromedriver/chrome_launcher_unittest.cc',
        'test/chromedriver/commands_unittest.cc',
        'test/chromedriver/logging_unittest.cc',
        'test/chromedriver/server/http_handler_unittest.cc',
        'test/chromedriver/session_commands_unittest.cc',
        'test/chromedriver/session_unittest.cc',
        'test/chromedriver/util_unittest.cc',
        'test/chromedriver/chrome/chrome_finder_unittest.cc',
      ],
    },
    {
      'target_name': 'xwalk_browsertest',
      'type': 'executable',
      'dependencies': [
        '../base/base.gyp:base',
        '../content/content.gyp:content_browser',
        '../content/content.gyp:content_common',
        '../content/content_shell_and_tests.gyp:test_support_content',
        '../net/net.gyp:net',
        '../skia/skia.gyp:skia',
        '../testing/gmock.gyp:gmock',
        '../testing/gtest.gyp:gtest',
        '../ui/ui.gyp:ui',
        '../third_party/libxml/libxml.gyp:libxml',
        'test/base/base.gyp:xwalk_test_base',
        'xwalk_application_lib',
        'xwalk_resources',
        'xwalk_runtime',
      ],
      'includes': [
        '../build/filename_rules.gypi',
      ],
      'defines': [
        'HAS_OUT_OF_PROC_TEST_RUNNER',
      ],
      'sources': [
        'application/test/application_browsertest.cc',
        'application/test/application_browsertest.h',
        'application/test/application_event_test.cc',
        'application/test/application_eventapi_test.cc',
        'application/test/application_main_document_browsertest.cc',
        'application/test/application_multi_app_test.cc',
        'application/test/application_testapi.cc',
        'application/test/application_testapi.h',
        'application/test/application_testapi_test.cc',
        'runtime/browser/devtools/xwalk_devtools_browsertest.cc',
        'runtime/browser/geolocation/xwalk_geolocation_browsertest.cc',
        'runtime/browser/ui/taskbar_util_browsertest_win.cc',
        'runtime/browser/xwalk_download_browsertest.cc',
        'runtime/browser/xwalk_form_input_browsertest.cc',
        'runtime/browser/xwalk_runtime_browsertest.cc',
        'runtime/browser/xwalk_switches_browsertest.cc',
      ],
    }
  ],
}
